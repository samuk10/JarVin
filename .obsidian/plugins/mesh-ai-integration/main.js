/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var dt=Object.create;var ye=Object.defineProperty;var gt=Object.getOwnPropertyDescriptor;var ht=Object.getOwnPropertyNames;var mt=Object.getPrototypeOf,ft=Object.prototype.hasOwnProperty;var vt=(c,r)=>()=>(r||c((r={exports:{}}).exports,r),r.exports),yt=(c,r)=>{for(var e in r)ye(c,e,{get:r[e],enumerable:!0})},Ve=(c,r,e,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of ht(r))!ft.call(c,t)&&t!==e&&ye(c,t,{get:()=>r[t],enumerable:!(n=gt(r,t))||n.enumerable});return c};var wt=(c,r,e)=>(e=c!=null?dt(mt(c)):{},Ve(r||!c||!c.__esModule?ye(e,"default",{value:c,enumerable:!0}):e,c)),bt=c=>Ve(ye({},"__esModule",{value:!0}),c);var We=vt((je,we)=>{((c,r)=>{typeof define=="function"&&define.amd?define([],r):typeof we=="object"&&we.exports?we.exports=r():c.fuzzysort=r()})(je,c=>{"use strict";var r=(l,s)=>{if(!l||!s)return C;var p=k(l);re(s)||(s=O(s));var m=p.bitflags;return(m&s._bitflags)!==m?C:D(p,s)},e=(l,s,p)=>{if(!l)return p!=null&&p.all?R(s,p):Oe;var m=k(l),f=m.bitflags,h=m.containsSpace,u=_((p==null?void 0:p.threshold)||0),y=(p==null?void 0:p.limit)||He,v=0,b=0,E=s.length;function q(ne){v<y?(fe.add(ne),++v):(++b,ne._score>fe.peek()._score&&fe.replaceTop(ne))}if(p!=null&&p.key)for(var B=p.key,S=0;S<E;++S){var K=s[S],x=me(K,B);if(x&&(re(x)||(x=O(x)),(f&x._bitflags)===f)){var T=D(m,x);T!==C&&(T._score<u||(T.obj=K,q(T)))}}else if(p!=null&&p.keys){var X=p.keys,J=X.length;e:for(var S=0;S<E;++S){var K=s[S];{for(var U=0,A=0;A<J;++A){var B=X[A],x=me(K,B);if(!x){Fe[A]=pe;continue}re(x)||(x=O(x)),Fe[A]=x,U|=x._bitflags}if((f&U)!==f)continue}if(h)for(let M=0;M<m.spaceSearches.length;M++)j[M]=Y;for(var A=0;A<J;++A){if(x=Fe[A],x===pe){ae[A]=pe;continue}if(ae[A]=D(m,x,!1,h),ae[A]===C){ae[A]=pe;continue}if(h)for(let I=0;I<m.spaceSearches.length;I++){if(te[I]>-1e3&&j[I]>Y){var H=(j[I]+te[I])/4;H>j[I]&&(j[I]=H)}te[I]>j[I]&&(j[I]=te[I])}}if(h){for(let M=0;M<m.spaceSearches.length;M++)if(j[M]===Y)continue e}else{var w=!1;for(let M=0;M<J;M++)if(ae[M]._score!==Y){w=!0;break}if(!w)continue}var z=new o(J);for(let M=0;M<J;M++)z[M]=ae[M];if(h){var L=0;for(let M=0;M<m.spaceSearches.length;M++)L+=j[M]}else{var L=Y;for(let I=0;I<J;I++){var T=z[I];if(T._score>-1e3&&L>Y){var H=(L+T._score)/4;H>L&&(L=H)}T._score>L&&(L=T._score)}}if(z.obj=K,z._score=L,p!=null&&p.scoreFn){if(L=p.scoreFn(z),!L)continue;L=_(L),z._score=L}L<u||q(z)}}else for(var S=0;S<E;++S){var x=s[S];if(x&&(re(x)||(x=O(x)),(f&x._bitflags)===f)){var T=D(m,x);T!==C&&(T._score<u||q(T))}}if(v===0)return Oe;for(var Z=new Array(v),S=v-1;S>=0;--S)Z[S]=fe.poll();return Z.total=v+b,Z},n=(l,s="<b>",p="</b>")=>{for(var m=typeof s=="function"?s:void 0,f=l.target,h=f.length,u=l.indexes,y="",v=0,b=0,E=!1,q=[],B=0;B<h;++B){var S=f[B];if(u[b]===B){if(++b,E||(E=!0,m?(q.push(y),y=""):y+=s),b===u.length){m?(y+=S,q.push(m(y,v++)),y="",q.push(f.substr(B+1))):y+=S+p+f.substr(B+1);break}}else E&&(E=!1,m?(q.push(m(y,v++)),y=""):y+=p);y+=S}return m?q:y},t=l=>{typeof l=="number"?l=""+l:typeof l!="string"&&(l="");var s=ce(l);return g(l,{_targetLower:s._lower,_targetLowerCodes:s.lowerCodes,_bitflags:s.bitflags})},a=()=>{Q.clear(),ee.clear()};class i{get indexes(){return this._indexes.slice(0,this._indexes.len).sort((s,p)=>s-p)}set indexes(s){return this._indexes=s}highlight(s,p){return n(this,s,p)}get score(){return P(this._score)}set score(s){this._score=_(s)}}class o extends Array{get score(){return P(this._score)}set score(s){this._score=_(s)}}var g=(l,s)=>{var m,f,h,u,y,v,b;let p=new i;return p.target=l,p.obj=(m=s.obj)!=null?m:C,p._score=(f=s._score)!=null?f:Y,p._indexes=(h=s._indexes)!=null?h:[],p._targetLower=(u=s._targetLower)!=null?u:"",p._targetLowerCodes=(y=s._targetLowerCodes)!=null?y:C,p._nextBeginningIndexes=(v=s._nextBeginningIndexes)!=null?v:C,p._bitflags=(b=s._bitflags)!=null?b:0,p},P=l=>l===Y?0:l>1?l:Math.E**(((-l+1)**.04307-1)*-2),_=l=>l===0?Y:l>1?l:1-Math.pow(Math.log(l)/-2+1,1/.04307),F=l=>{typeof l=="number"?l=""+l:typeof l!="string"&&(l=""),l=l.trim();var s=ce(l),p=[];if(s.containsSpace){var m=l.split(/\s+/);m=[...new Set(m)];for(var f=0;f<m.length;f++)if(m[f]!==""){var h=ce(m[f]);p.push({lowerCodes:h.lowerCodes,_lower:m[f].toLowerCase(),containsSpace:!1})}}return{lowerCodes:s.lowerCodes,_lower:s._lower,containsSpace:s.containsSpace,bitflags:s.bitflags,spaceSearches:p}},O=l=>{if(l.length>999)return t(l);var s=Q.get(l);return s!==void 0||(s=t(l),Q.set(l,s)),s},k=l=>{if(l.length>999)return F(l);var s=ee.get(l);return s!==void 0||(s=F(l),ee.set(l,s)),s},R=(l,s)=>{var p=[];p.total=l.length;var m=(s==null?void 0:s.limit)||He;if(s!=null&&s.key)for(var f=0;f<l.length;f++){var h=l[f],u=me(h,s.key);if(u!=C){re(u)||(u=O(u));var y=g(u.target,{_score:u._score,obj:h});if(p.push(y),p.length>=m)return p}}else if(s!=null&&s.keys)for(var f=0;f<l.length;f++){for(var h=l[f],v=new o(s.keys.length),b=s.keys.length-1;b>=0;--b){var u=me(h,s.keys[b]);if(!u){v[b]=pe;continue}re(u)||(u=O(u)),u._score=Y,u._indexes.len=0,v[b]=u}if(v.obj=h,v._score=Y,p.push(v),p.length>=m)return p}else for(var f=0;f<l.length;f++){var u=l[f];if(u!=C&&(re(u)||(u=O(u)),u._score=Y,u._indexes.len=0,p.push(u),p.length>=m))return p}return p},D=(l,s,p=!1,m=!1)=>{if(p===!1&&l.containsSpace)return Ge(l,s,m);for(var f=l._lower,h=l.lowerCodes,u=h[0],y=s._targetLowerCodes,v=h.length,b=y.length,S=0,E=0,q=0;;){var B=u===y[E];if(B){if(V[q++]=E,++S,S===v)break;u=h[S]}if(++E,E>=b)return C}var S=0,K=!1,x=0,T=s._nextBeginningIndexes;T===C&&(T=s._nextBeginningIndexes=ze(s.target)),E=V[0]===0?0:T[V[0]-1];var X=0;if(E!==b)for(;;)if(E>=b){if(S<=0||(++X,X>200))break;--S;var J=ge[--x];E=T[J]}else{var B=h[S]===y[E];if(B){if(ge[x++]=E,++S,S===v){K=!0;break}++E}else E=T[E]}var U=v<=1?-1:s._targetLower.indexOf(f,V[0]),A=!!~U,H=A?U===0||s._nextBeginningIndexes[U-1]===U:!1;if(A&&!H){for(var w=0;w<T.length;w=T[w])if(!(w<=U)){for(var z=0;z<v&&h[z]===s._targetLowerCodes[w+z];z++);if(z===v){U=w,H=!0;break}}}var L=M=>{for(var I=0,Je=0,W=1;W<v;++W)M[W]-M[W-1]!==1&&(I-=M[W],++Je);var ut=M[v-1]-M[0]-(v-1);if(I-=(12+ut)*Je,M[0]!==0&&(I-=M[0]*M[0]*.2),!K)I*=1e3;else{for(var ke=1,W=T[0];W<b;W=T[W])++ke;ke>24&&(I*=(ke-24)*10)}return I-=(b-v)/2,A&&(I/=1+v*v*1),H&&(I/=1+v*v*1),I-=(b-v)/2,I};if(K)if(H){for(var w=0;w<v;++w)V[w]=U+w;var Z=V,ne=L(V)}else var Z=ge,ne=L(ge);else{if(A)for(var w=0;w<v;++w)V[w]=U+w;var Z=V,ne=L(Z)}s._score=ne;for(var w=0;w<v;++w)s._indexes[w]=Z[w];s._indexes.len=v;let ve=new i;return ve.target=s.target,ve._score=s._score,ve._indexes=s._indexes,ve},Ge=(l,s,p)=>{for(var m=new Set,f=0,h=C,u=0,y=l.spaceSearches,v=y.length,b=0,E=()=>{for(let H=b-1;H>=0;H--)s._nextBeginningIndexes[he[H*2+0]]=he[H*2+1]},q=!1,A=0;A<v;++A){te[A]=Y;var B=y[A];if(h=D(B,s),p){if(h===C)continue;q=!0}else if(h===C)return E(),C;var S=A===v-1;if(!S){var K=h._indexes,x=!0;for(let w=0;w<K.len-1;w++)if(K[w+1]-K[w]!==1){x=!1;break}if(x){var T=K[K.len-1]+1,X=s._nextBeginningIndexes[T-1];for(let w=T-1;w>=0&&X===s._nextBeginningIndexes[w];w--)s._nextBeginningIndexes[w]=T,he[b*2+0]=w,he[b*2+1]=X,b++}}f+=h._score/v,te[A]=h._score/v,h._indexes[0]<u&&(f-=(u-h._indexes[0])*2),u=h._indexes[0];for(var J=0;J<h._indexes.len;++J)m.add(h._indexes[J])}if(p&&!q)return C;E();var U=D(l,s,!0);if(U!==C&&U._score>f){if(p)for(var A=0;A<v;++A)te[A]=U._score/v;return U}p&&(h=s),h._score=f;var A=0;for(let H of m)h._indexes[A++]=H;return h._indexes.len=A,h},ce=l=>{for(var s=l.length,p=l.toLowerCase(),m=[],f=0,h=!1,u=0;u<s;++u){var y=m[u]=p.charCodeAt(u);if(y===32){h=!0;continue}var v=y>=97&&y<=122?y-97:y>=48&&y<=57?26:y<=127?30:31;f|=1<<v}return{lowerCodes:m,bitflags:f,containsSpace:h,_lower:p}},Ye=l=>{for(var s=l.length,p=[],m=0,f=!1,h=!1,u=0;u<s;++u){var y=l.charCodeAt(u),v=y>=65&&y<=90,b=v||y>=97&&y<=122||y>=48&&y<=57,E=v&&!f||!h||!b;f=v,h=b,E&&(p[m++]=u)}return p},ze=l=>{for(var s=l.length,p=Ye(l),m=[],f=p[0],h=0,u=0;u<s;++u)f>u?m[u]=f:(f=p[++h],m[u]=f===void 0?s:f);return m},Q=new Map,ee=new Map,V=[],ge=[],he=[],j=[],te=[],Fe=[],ae=[],me=(l,s)=>{var p=l[s];if(p!==void 0)return p;if(typeof s=="function")return s(l);var m=s;Array.isArray(s)||(m=s.split("."));for(var f=m.length,h=-1;l&&++h<f;)l=l[m[h]];return l},re=l=>typeof l=="object"&&typeof l._bitflags=="number",He=1/0,Y=-He,Oe=[];Oe.total=0;var C=null,pe=t(""),pt=l=>{var s=[],p=0,m={},f=h=>{for(var u=0,y=s[u],v=1;v<p;){var b=v+1;u=v,b<p&&s[b]._score<s[v]._score&&(u=b),s[u-1>>1]=s[u],v=1+(u<<1)}for(var E=u-1>>1;u>0&&y._score<s[E]._score;E=(u=E)-1>>1)s[u]=s[E];s[u]=y};return m.add=h=>{var u=p;s[p++]=h;for(var y=u-1>>1;u>0&&h._score<s[y]._score;y=(u=y)-1>>1)s[u]=s[y];s[u]=h},m.poll=h=>{if(p!==0){var u=s[0];return s[0]=s[--p],f(),u}},m.peek=h=>{if(p!==0)return s[0]},m.replaceTop=h=>{s[0]=h,f()},m},fe=pt();return{single:r,go:e,prepare:t,cleanup:a}})});var At={};yt(At,{default:()=>Ne});module.exports=bt(At);var N=require("obsidian");var ie=require("obsidian");var ue=require("obsidian"),tt=wt(We());var se=require("obsidian"),be=class extends se.Modal{constructor(e,n,t,a,i){super(e);this.youtubeLinks=t,this.onRun=a,this.onSkip=i,this.youtubeProvider=n.youtubeProvider}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"YouTube Links Detected"});let n=e.createEl("select");this.youtubeLinks.forEach(t=>{let a=n.createEl("option",{text:t});a.value=t}),new se.Setting(e).addButton(t=>{t.setButtonText("Run").setCta().onClick(async()=>{let a=n.value;if(a)try{let i=await this.youtubeProvider.getTranscript(a);this.onRun(i),this.close()}catch(i){new se.Notice(`Failed to fetch YouTube transcript: ${i.message}`),this.onSkip(),this.close()}else new se.Notice("Please select a YouTube link")})}).addButton(t=>{t.setButtonText("Skip").onClick(()=>{this.onSkip(),this.close()})})}onClose(){let{contentEl:e}=this;e.empty()}};var Pe=require("obsidian");async function Xe(c){let r=c.workspace.getActiveFile();if(r instanceof Pe.TFile)return await c.vault.read(r);throw new Error("No active note found")}async function Re(c,r,e){let n=c.settings.meshOutputFolder;if(!n)throw new Error("Mesh output folder not set");let t=e.value.trim()||"Mesh Note",a=`${t}.md`,i=1;for(;await c.app.vault.adapter.exists(`${n}/${a}`);)a=`${t} (${i}).md`,i++;let o=`${n}/${a}`;await c.app.vault.create(o,r),new Pe.Notice(`File created: ${a}`);let g=c.app.vault.getAbstractFileByPath(o);await this.app.workspace.getLeaf(!1).openFile(g)}async function De(c,r,e){try{return await c.getProvider(r).generateResponse(e)}catch(n){throw d(c,`LLM Request failed: ${n}`),new Error(`LLM Request failed: ${n.message}`)}}var Be=`
# You will be given prompt instructions that should not be included in your generation, just the content below the divider. The divider is a series of 10 asterisks (*) on a new line.

{patternContents}

You are now tasked with processing the data that follows, applying the guidelines and structure outlined in the previous prompt. Your primary goal is to enhance the rough notes into well-organized, detailed, and contextually rich documentation. Ensure that all data is accurately captured, formatted in markdown, and made easily retrievable for future reference.

Key Instructions:

Maintain Consistency: Keep the formatting consistent throughout the document, adhering to the markdown structure provided.
Contextual Clarity: Add or infer any missing details to enhance the clarity and context of the notes.
Summarization and Structuring: Make the notes concise but informative, ensuring that they are structured in a way that aids retrieval by a RAG system.
Task Identification: Pay special attention to tasks, ensuring they are clearly marked with appropriate statuses (incomplete, completed, in progress) and use the provided icons and formats to enhance readability.
Resource Linking: If any online resources are mentioned or inferred, link them appropriately using official URLs or PDFs.
Define Uncommon Terms: Identify and define any uncommon or significant terms, linking to relevant wiki pages where possible.
Data Availability: If no data follows this prompt, return an error indicating that no data was sent to process.
Proceed to process the data below according to these guidelines.

**********

{input}
`;async function Ze(c,r,e,n){let t=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=)?(?:embed\/)?(?:v\/)?(?:shorts\/)?(?:\S+)/g,a="";switch(e){case"active-note":case"clipboard":a=e==="active-note"?await Xe(c):await navigator.clipboard.readText();let i=Array.from(a.match(t)||[]);i&&i.length>0&&(a=await new Promise(o=>{new be(c,r,i,g=>{o(`YouTube Transcript:

${g}

Original Content:

${a}`)},()=>{o(a)}).open()}));break;case"tavily":d(r,"Searching Tavily for:",n.value),a=await r.tavilyProvider.search(n.value);break}if(!a)throw new Error("No input content available");return a}function d(c,...r){c.settings.enableDebugging&&console.log(...r)}async function Qe(c,r,e,n){let t=n;for(let a of e){let i=await Ue(c,a),o=Be.replace("{patternContents}",i).replace("{input}",t);d(c,`Applying pattern: ${a}`),d(c,"Full prompt being sent to LLM:",o),t=await De(c,r,o)}return t}async function et(c,r,e,n){let t="";for(let a of e){let i=await Ue(c,a),o=Be.replace("{patternContents}",i).replace("{input}",n),g=await De(c,r,o);t+=`# ${a}

---

${g}


`}return t}async function Ue(c,r){d(c,`Searching for pattern: ${r}`);async function e(t){let a=c.app.vault.getAbstractFileByPath(t);if(a instanceof ue.TFolder){d(c,`Searching in folder: ${t}`);let i=a.children.filter(g=>g instanceof ue.TFile);d(c,`Files in folder: ${i.map(g=>g.name).join(", ")}`);let o=i.find(g=>g.name===r);if(o||(o=i.find(g=>g.name===`${r}.md`)),o||(o=i.find(g=>g.name.toLowerCase()===r.toLowerCase())),o&&o instanceof ue.TFile)return d(c,`Pattern found: ${o.path}`),o}else d(c,`Folder not found: ${t}`);return null}let n=await e(c.settings.customPatternsFolder);if(n||(n=await e(c.settings.fabricPatternsFolder)),n)return await c.app.vault.read(n);throw d(c,`Pattern '${r}' not found in custom or fabric patterns folders`),new Error(`Pattern '${r}' not found in custom or fabric patterns folders`)}async function Pt(c,r,e=10){let n=[...await c.loadCustomPatterns(),...await c.loadFabricPatterns()];return tt.go(r,n,{limit:e})}async function rt(c,r,e,n){if(e.empty(),r.length===0){e.addClass("hidden");return}let t=await Pt(c,r);t.length>0?(t.forEach(a=>{e.createEl("div",{text:a.target,cls:"pattern-result"}).addEventListener("click",()=>n(a.target))}),e.removeClass("hidden")):e.addClass("hidden")}function nt(c,r,e,n,t){r.includes(c)||(r.push(c),e()),n(),t()}function Ke(c,r,e){c.empty(),r.forEach(n=>{let t=Et(n,a=>{let i=r.filter(o=>o!==a);e(i),Ke(c,i,e)});c.appendChild(t)})}function Et(c,r){let e=document.createElement("div");return e.textContent=c,e.className="selected-pattern",e.createEl("span",{text:"\xD7",cls:"remove-pattern"}).addEventListener("click",()=>r(c)),e}var de=class{constructor(r){this.containerEl=r}static createSelect(r,e,n){let t=(r instanceof HTMLElement,r).createEl("select",{cls:e});return n.forEach(a=>{t.createEl("option",{value:a,text:a})}),t}createUI(r,e){this.containerEl.empty(),this.containerEl.addClass("mesh-ai-container");let n=this.containerEl.createEl("h2",{text:"Mesh AI"}),t=this.createProviderSelect(r),a=this.createPromptInput();this.createSubmitButton().addEventListener("click",()=>{let g=t.value,P=a.value;P&&e(g,P)});let o=this.containerEl.createEl("div",{cls:"mesh-ai-response"});return{updateResponse:g=>{o.empty(),o.createEl("pre").setText(g)},showLoading:()=>{o.empty(),o.createEl("div",{text:"Processing...",cls:"mesh-ai-loading"})},hideLoading:()=>{o.empty()}}}createProviderSelect(r){let e=this.containerEl.createEl("div",{cls:"mesh-ai-select-container"});e.createEl("label",{text:"Select Provider:",attr:{for:"mesh-ai-provider"}});let n=e.createEl("select",{cls:"mesh-ai-select",attr:{id:"mesh-ai-provider"}});return[{value:"openai",label:"OpenAI"},{value:"google",label:"Google"},{value:"microsoft",label:"Microsoft"},{value:"anthropic",label:"Anthropic"},{value:"grocq",label:"Grocq"},{value:"ollama",label:"Ollama"}].forEach(a=>{let i=n.createEl("option",{value:a.value,text:a.label});this.isProviderConfigured(a.value,r)?i.disabled=!1:i.disabled=!0}),n}isProviderConfigured(r,e){return r==="ollama"?!!e.ollamaServerUrl:!!e[`${r}ApiKey`]}createPromptInput(){let r=this.containerEl.createEl("div",{cls:"mesh-ai-input-container"});return r.createEl("label",{text:"Enter your prompt:",attr:{for:"mesh-ai-prompt"}}),r.createEl("textarea",{cls:"mesh-ai-input",attr:{id:"mesh-ai-prompt",rows:"4"}})}createSubmitButton(){return this.containerEl.createEl("button",{cls:"mesh-ai-submit",text:"Submit"})}};var oe="mesh-view",Ee=class extends ie.ItemView{constructor(e,n){super(e);this.selectedPatterns=[];this.handleClickOutside=e=>{(!(e.target instanceof Node)||!this.patternResults.contains(e.target))&&this.patternResults.addClass("hidden")};this.plugin=n,this.patternStitchingEnabled=this.plugin.settings.patternStitchingEnabled}getViewType(){return oe}getDisplayText(){return"Mesh AI"}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.addClass("mesh-view-container");let n=e.createEl("div",{cls:"particles-js",attr:{id:"particles-js"}}),t=e.createEl("div",{cls:"mesh-form-container"}),a=this.createCard(t,"provider"),i=de.createSelect(a,"mesh-provider-select",["openai","google","microsoft","anthropic","grocq","ollama"]),o=this.createCard(t,"input"),g=de.createSelect(o,"mesh-input-source-select",["active-note","clipboard","tavily"]),P=o.createEl("input",{type:"text",placeholder:"Enter Tavily search query",cls:"mesh-tavily-input hidden"});P.addClass("hidden"),g.addEventListener("change",()=>{P.toggleClass("hidden",g.value!=="tavily")});let _=this.createCard(t,"patterns"),F=_.createEl("div",{cls:"pattern-search-container"});this.patternInput=new ie.TextComponent(F).setPlaceholder("Search patterns...").onChange(Q=>{rt(this.plugin,Q,this.patternResults,ee=>{nt(ee,this.selectedPatterns,()=>Ke(this.selectedPatternsContainer,this.selectedPatterns,V=>{this.selectedPatterns=V}),()=>this.patternInput.setValue(""),()=>this.patternResults.empty())})}),this.patternResults=F.createEl("div",{cls:"pattern-results"});let O=_.createEl("h4",{text:"Selected Patterns",cls:"mesh-selected-patterns-title"});this.selectedPatternsContainer=_.createEl("div",{cls:"selected-patterns-container"});let k=_.createEl("div",{cls:"pattern-stitching-container"}),R=k.createEl("label",{cls:"switch"}),D=R.createEl("input",{type:"checkbox",cls:"pattern-stitching-input"});D.checked=this.patternStitchingEnabled,R.createEl("span",{cls:"slider round"});let Ge=k.createEl("span",{text:"Pattern Stitching",cls:"pattern-stitching-label"});D.addEventListener("change",Q=>{this.patternStitchingEnabled=Q.target.checked,this.plugin.settings.patternStitchingEnabled=this.patternStitchingEnabled,this.plugin.saveSettings();let ee=this.patternStitchingEnabled?"enabled":"disabled";new ie.Notice(`Pattern Stitching ${ee}.`)});let ce=this.createCard(t,"output");this.outputFileNameInput=ce.createEl("input",{type:"text",placeholder:"Output file name (optional)",cls:"mesh-output-filename-input"}),t.createEl("div",{cls:"mesh-submit-button-container"}).createEl("button",{text:"Submit",cls:"mesh-submit-button"}).addEventListener("click",this.onSubmit.bind(this)),this.loadingElement=e.createEl("div",{text:"Processing...",cls:"mesh-loading"}),this.loadingElement.hide(),this.initParticles(),document.addEventListener("click",this.handleClickOutside)}initParticles(){let e=this.containerEl.children[1],n=e.createEl("div",{cls:"particles-js",attr:{id:"particles-js"}});if(window.particlesJS){let t=()=>{window.particlesJS("particles-js",{particles:{number:{value:80,density:{enable:!0,value_area:800}},color:{value:["#81a0ed","#694daa"]},shape:{type:"circle"},opacity:{value:.5,random:!1},size:{value:3,random:!0},line_linked:{enable:!0,distance:150,color:"#81a0ed",opacity:.4,width:1},move:{enable:!0,speed:2,direction:"none",random:!1,straight:!1,out_mode:"out",bounce:!1}},interactivity:{detect_on:"canvas",events:{onhover:{enable:!0,mode:"repulse"},onclick:{enable:!0,mode:"push"},resize:!0},modes:{grab:{distance:400,line_linked:{opacity:1}},bubble:{distance:400,size:40,duration:2,opacity:8,speed:3},repulse:{distance:200,duration:.4},push:{particles_nb:4},remove:{particles_nb:2}}},retina_detect:!0})};t();let a=this.debounce(()=>{window.pJSDom&&window.pJSDom[0]&&window.pJSDom[0].pJS&&window.pJSDom[0].pJS.fn.vendors.destroypJS(),t()},250);window.addEventListener("resize",a),new ResizeObserver(()=>{let o=n.querySelector("canvas");o&&(o.width=n.clientWidth,o.height=n.clientHeight)}).observe(e)}}debounce(e,n){let t=null;return(...a)=>{t&&clearTimeout(t),t=setTimeout(()=>e(...a),n)}}createCard(e,n){let t=e.createEl("div",{cls:`mesh-card ${n.toLowerCase()}`});return t.createEl("h3",{text:n,cls:"mesh-card-title"}),t}updateTheme(){let e=document.body.classList.contains("theme-dark");this.containerEl.toggleClass("theme-dark",e),this.containerEl.toggleClass("theme-light",!e)}async onSubmit(){d(this.plugin,"onSubmit method called");let e=this.containerEl.querySelector(".mesh-provider-select"),n=this.containerEl.querySelector(".mesh-input-source-select"),t=this.containerEl.querySelector(".mesh-tavily-input");d(this.plugin,"Selected provider:",e.value),d(this.plugin,"Selected input source:",n.value),d(this.plugin,"Tavily search input:",t.value);let a=e.value,i=n.value,o=this.selectedPatterns;try{d(this.plugin,"Getting input content...");let g=await Ze(this.app,this.plugin,i,t);if(this.showLoading(),d(this.plugin,"Processing patterns..."),this.patternStitchingEnabled){let P=await et(this.plugin,a,o,g);d(this.plugin,"Creating output file..."),await Re(this.plugin,P,this.outputFileNameInput)}else{let P=await Qe(this.plugin,a,o,g);d(this.plugin,"Creating output file..."),await Re(this.plugin,P,this.outputFileNameInput)}}catch(g){d(this.plugin,"Error processing request:",g),new ie.Notice(`Error: ${g.message}`)}finally{this.hideLoading()}}async showLoading(){let e=this.containerEl.querySelector(".mesh-form-container"),n=Array.from(e.querySelectorAll(".mesh-card")),t=this.containerEl.querySelector(".mesh-submit-button-container"),a=t.querySelector(".mesh-submit-button");for(let i=0;i<n.length;i++){let o=n[i];o.classList.add("rotating"),await new Promise(g=>setTimeout(g,500)),o.addEventListener("animationend",()=>{o.classList.remove("rotating")},{once:!0})}t.classList.add("processing"),a.classList.add("processing"),a.disabled=!0}hideLoading(){let n=this.containerEl.querySelector(".mesh-form-container").querySelectorAll(".mesh-card"),t=this.containerEl.querySelector(".mesh-submit-button-container"),a=t.querySelector(".mesh-submit-button");n.forEach(i=>{i.classList.remove("rotating")}),t.classList.remove("processing"),a.classList.remove("processing"),a.disabled=!1}};var $=require("obsidian");var Ae=class extends $.PluginSettingTab{constructor(e,n){super(e,n);this.plugin=n}async display(){let{containerEl:e}=this;e.empty();let n=["openai","google","microsoft","anthropic","grocq","ollama"];for(let t of n)if(t==="ollama"?new $.Setting(e).setName("Ollama server URL").setDesc("Enter the URL for your Ollama server").addText(i=>i.setPlaceholder("Enter URL").setValue(this.plugin.settings.ollamaServerUrl).onChange(async o=>{this.plugin.settings.ollamaServerUrl=o,await this.plugin.saveSettings()})):new $.Setting(e).setName(`${t.charAt(0).toUpperCase()+t.slice(1)} API key`).setDesc(`Enter your ${t} API key`).addText(i=>i.setPlaceholder("Enter API key").setValue(this.plugin.settings[`${t}ApiKey`]).onChange(async o=>{this.plugin.settings[`${t}ApiKey`]=o,await this.plugin.saveSettings()})),t==="ollama"?this.plugin.settings.ollamaServerUrl:this.plugin.settings[`${t}ApiKey`]){let i=new $.Setting(e).setName(`${t.charAt(0).toUpperCase()+t.slice(1)} model`).setDesc(`Select the model for ${t}`).addDropdown(async o=>{await this.populateModelDropdown(o,t)});i.addButton(o=>{o.setButtonText("Refresh models").onClick(async()=>{let g=i.components[0];await this.populateModelDropdown(g,t,!0)})})}new $.Setting(e).setName("Selected provider").setDesc("Choose the default provider").addDropdown(t=>{n.forEach(a=>{(a==="ollama"?this.plugin.settings.ollamaServerUrl:this.plugin.settings[`${a}ApiKey`])&&t.addOption(a,a)}),t.setValue(this.plugin.settings.selectedProvider).onChange(async a=>{this.plugin.settings.selectedProvider=a,await this.plugin.saveSettings()})}),new $.Setting(e).setName("Tavily API key").setDesc("Enter your Tavily API key").addText(t=>t.setPlaceholder("Enter API key").setValue(this.plugin.settings.tavilyApiKey).onChange(async a=>{this.plugin.settings.tavilyApiKey=a,await this.plugin.saveSettings()})),new $.Setting(e).setName("YouTube API key").setDesc("Enter your YouTube API key for transcript fetching").addText(t=>t.setPlaceholder("Enter API key").setValue(this.plugin.settings.youtubeApiKey).onChange(async a=>{this.plugin.settings.youtubeApiKey=a,await this.plugin.saveSettings()})),new $.Setting(e).setName("Custom patterns folder").setDesc(`Enter the name of the folder containing custom patterns. If it's in the root of your vault, just enter the folder name (e.g., "Custom Patterns").`).addText(t=>t.setPlaceholder("Custom Patterns").setValue(this.plugin.settings.customPatternsFolder).onChange(async a=>{this.plugin.settings.customPatternsFolder=a,await this.plugin.saveSettings()})),new $.Setting(e).setName("Fabric Patterns Folder").setDesc("Folder where downloaded patterns will be saved").addText(t=>t.setPlaceholder("Enter folder path").setValue(this.plugin.settings.fabricPatternsFolder).onChange(async a=>{this.plugin.settings.fabricPatternsFolder=a,await this.plugin.saveSettings()})),new $.Setting(e).setName("Download Patterns").setDesc("Download patterns from GitHub").addButton(t=>{t.setButtonText("Download").onClick(async()=>{let a=t.buttonEl.textContent||"Download";t.setDisabled(!0),t.buttonEl.addClass("loading"),t.setButtonText("Downloading...");try{await this.plugin.downloadPatternsFromGitHub(),new $.Notice("Patterns downloaded successfully")}catch(i){console.error("Error downloading patterns:",i),new $.Notice(`Failed to download patterns: ${i instanceof Error?i.message:String(i)}`)}finally{t.setDisabled(!1),t.buttonEl.removeClass("loading"),t.setButtonText(a),this.display()}})}),new $.Setting(e).setName("Mesh output folder").setDesc("Enter the name of the folder for Mesh AI output. If it's in the root of your vault, just enter the folder name.").addText(t=>t.setPlaceholder("Mesh Output").setValue(this.plugin.settings.meshOutputFolder).onChange(async a=>{this.plugin.settings.meshOutputFolder=a,await this.plugin.saveSettings()})),new $.Setting(e).setName("Enable Debugging").setDesc("Turn on console logging for debugging purposes").addToggle(t=>t.setValue(this.plugin.settings.enableDebugging).onChange(async a=>{this.plugin.settings.enableDebugging=a;let i=this.plugin.settings.enableDebugging?"enabled":"disabled";new $.Notice(`Debugging ${i}.`),await this.plugin.saveSettings()}))}async populateModelDropdown(e,n,t=!1){var a;e.selectEl.disabled=!0;try{let i;if(t?i=await this.getModelsForProvider(n):i=this.plugin.settings.providerModels[n]||await this.getModelsForProvider(n),e.selectEl.empty(),i&&i.length>0){i.forEach(P=>e.addOption(P,P));let o=(a=this.plugin.settings.providerModels[n])==null?void 0:a[0],g=i.includes(o)?o:i[0];e.setValue(g).onChange(async P=>{this.plugin.settings.providerModels[n]=[P],await this.plugin.saveSettings()})}else e.addOption("","No models available"),d(this.plugin,`No models available for ${n}`)}catch(i){d(this.plugin,`Error fetching models for ${n}:`,i),e.addOption("error","Error fetching models")}finally{e.selectEl.disabled=!1}}async getModelsForProvider(e){try{let n=this.plugin.getProvider(e);if(n&&"getAvailableModels"in n)return await n.getAvailableModels()}catch(n){d(this.plugin,`Error fetching models for ${e}:`,n)}return this.plugin.settings.providerModels[e]||[]}};var st={openaiApiKey:"",googleApiKey:"",microsoftApiKey:"",anthropicApiKey:"",grocqApiKey:"",tavilyApiKey:"",youtubeApiKey:"",ollamaServerUrl:"http://localhost:11434",selectedProvider:"openai",selectedModel:"",providerModels:{openai:[],google:[],microsoft:[],anthropic:[],grocq:[],ollama:[]},customPatternsFolder:"",fabricPatternsFolder:"",meshOutputFolder:"",patternStitchingEnabled:!1,enableDebugging:!1};var le=class{constructor(r,e={}){this.baseUrl=r,this.headers=e}async fetchWithErrorHandling(r,e){let n=await fetch(r,e);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n}};var G=class extends le{constructor(e,n,t){super(e,n);this.plugin=t}async get(e){let n=await fetch(`${this.baseUrl}${e}`,{method:"GET",headers:this.headers});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n.json()}async post(e,n,t=!1){let a=await fetch(`${this.baseUrl}${e}`,{method:"POST",headers:this.headers,body:JSON.stringify(n)});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return t?a:await a.json()}async postStream(e,n,t){var g;let i=(g=(await this.fetchWithErrorHandling(`${this.baseUrl}${e}`,{method:"POST",headers:{"Content-Type":"application/json",...this.headers},body:JSON.stringify(n)})).body)==null?void 0:g.getReader(),o=new TextDecoder;if(i)try{for(;;){let{done:P,value:_}=await i.read();if(P)break;let O=o.decode(_,{stream:!0}).split(`
`).filter(k=>k.trim()!=="");for(let k of O)if(k.startsWith("data: ")){let R=k.slice(6);if(R==="[DONE]")break;try{let D=JSON.parse(R);t(D)}catch(D){d(this.plugin,`Error parsing JSON: ${D}`)}}}}finally{i.releaseLock()}}};var Se=class{constructor(r,e){this.apiHelper=new G("https://api.openai.com/v1",{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},this.plugin),this.plugin=e}async generateResponse(r,e){let n=this.plugin.settings.providerModels.openai,t=n&&n.length>0?n[0]:"gpt-3.5-turbo";if(d(this.plugin,`Using OpenAI model: ${t}`),!t)throw new Error("No OpenAI model has been selected. Please choose a model in the settings.");let a="/chat/completions",i={model:t,messages:[{role:"system",content:"You are a helpful assistant."},{role:"user",content:r}],stream:!!e};try{if(e){let o="";return await this.apiHelper.postStream(a,i,g=>{if(g.choices&&g.choices[0].delta&&g.choices[0].delta.content){let P=g.choices[0].delta.content;o+=P,e(P)}}),o.trim()}else{let o=await this.apiHelper.post(a,i);if(o.choices&&o.choices[0]&&o.choices[0].message)return o.choices[0].message.content.trim();throw new Error("Unexpected response format from OpenAI API")}}catch(o){throw d(this.plugin,`Error generating response with model ${t}: ${o}`),o.response&&(d(this.plugin,`Response status: ${o.response.status}`),d(this.plugin,`Response data: ${JSON.stringify(o.response.data)}`)),new Error(`Failed to generate response: ${o.message}`)}}async getAvailableModels(){try{let r=await this.apiHelper.get("/models");if(r.data&&Array.isArray(r.data))return r.data.filter(e=>e.id.startsWith("gpt-")).map(e=>e.id);throw new Error("Unexpected response format from OpenAI API")}catch(r){throw d(this.plugin,`Error fetching OpenAI models: ${r}`),r}}};var it=require("obsidian");var xe=class{constructor(r,e){this.apiHelper=new G("https://generativelanguage.googleapis.com/v1beta",{"x-goog-api-key":r},this.plugin),this.plugin=e}async getAvailableModels(){try{let r=await this.apiHelper.post("/models",{});if(r.models&&Array.isArray(r.models))return r.models.filter(e=>e.supportedGenerationMethods.includes("generateContent")).map(e=>e.name);throw new Error("Unexpected response format from Google API")}catch(r){throw d(this.plugin,`Error fetching Google models: ${r}`),r}}async generateResponse(r,e){let n=this.plugin.settings.providerModels.google,t=n&&n.length>0?n[0]:"chat-bison-001";t||new it.Notice('No Google model has been selected. Using default model "chat-bison-001".');let a="";try{return await this.apiHelper.postStream(`/models/${t}:streamGenerateContent`,{contents:[{parts:[{text:r}]}],safety_settings:[{category:"HARM_CATEGORY_DANGEROUS",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}]},i=>{if(i.candidates&&i.candidates[0].content&&i.candidates[0].content.parts){let o=i.candidates[0].content.parts[0].text;a+=o,e&&e(o)}}),a}catch(i){throw d(this.plugin,`Error generating response with model ${t}: ${i}`),new Error(`Failed to generate response: ${i.message}`)}}};var at=require("obsidian");var Me=class{constructor(r,e){this.apiHelper=new G("https://api.cognitive.microsoft.com",{"api-key":r},this.plugin),this.plugin=e}async getAvailableModels(){try{let r=await this.apiHelper.post("/openai/deployments?api-version=2023-05-15",{});if(r.value&&Array.isArray(r.value))return r.value.filter(e=>e.model.startsWith("gpt")).map(e=>e.id);throw new Error("Unexpected response format from Microsoft API")}catch(r){throw d(this.plugin,`Error fetching Microsoft models: ${r}`),r}}async generateResponse(r,e){let n=this.plugin.settings.providerModels.microsoft,t=n&&n.length>0?n[0]:"gpt-35-turbo";t||new at.Notice('No Microsoft model has been selected. Using default model "gpt-35-turbo".');let a="";try{return await this.apiHelper.postStream(`/openai/deployments/${t}/chat/completions?api-version=2023-05-15`,{messages:[{role:"user",content:r}],stream:!0},i=>{if(i.choices&&i.choices[0].delta&&i.choices[0].delta.content){let o=i.choices[0].delta.content;a+=o,e&&e(o)}}),a}catch(i){throw d(this.plugin,`Error generating response with model ${t}: ${i}`),new Error(`Failed to generate response: ${i.message}`)}}};var ot=require("obsidian");var Te=class{constructor(r,e){this.apiHelper=new G("https://api.anthropic.com/v1",{"x-api-key":r,"anthropic-version":"2023-06-01"},this.plugin),this.plugin=e}async getAvailableModels(){try{let r=await this.apiHelper.post("/models",{});if(r.models&&Array.isArray(r.models))return r.models.filter(e=>e.type==="chat").map(e=>e.id);throw new Error("Unexpected response format from Anthropic API")}catch(r){throw d(this.plugin,`Error fetching Anthropic models: ${r}`),r}}async generateResponse(r,e){let n=this.plugin.settings.providerModels.anthropic,t=n&&n.length>0?n[0]:"claude-2";t||new ot.Notice('No Anthropic model has been selected. Using default model "claude-2".');let a="";try{return await this.apiHelper.postStream("/messages",{model:t,messages:[{role:"user",content:r}],max_tokens:1e3,stream:!0},i=>{var o;if(i.type==="content_block_delta"&&((o=i.delta)!=null&&o.text)){let g=i.delta.text;a+=g,e&&e(g)}}),a}catch(i){throw d(this.plugin,`Error generating response with model ${t}: ${i}`),new Error(`Failed to generate response: ${i.message}`)}}};var lt=require("obsidian");var Ie=class{constructor(r,e){this.apiHelper=new G("https://api.groq.com/openai/v1",{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},this.plugin),this.plugin=e}async getAvailableModels(){try{let r=await this.apiHelper.get("/models");if(r.data&&Array.isArray(r.data))return r.data.map(e=>e.id);throw new Error("Unexpected response format from Groq API")}catch(r){throw d(this.plugin,`Error fetching Groq models: ${r}`),r}}async generateResponse(r,e){let n=this.plugin.settings.providerModels.grocq,t=n&&n.length>0?n[0]:"mixtral-8x7b-32768";t||new lt.Notice('No Groq model has been selected. Using default model "mixtral-8x7b-32768".');try{let a=await this.apiHelper.post("/chat/completions",{model:t,messages:[{role:"user",content:r}]});if(a.choices&&a.choices.length>0){let i=a.choices[0].message.content;return e&&e(i),i}else throw new Error("No response content received from Groq API")}catch(a){throw d(this.plugin,`Error generating response with model ${t}: ${a}`),new Error(`Failed to generate response: ${a.message}`)}}};var ct=require("obsidian");var _e=class extends le{constructor(e,n){super(e);this.plugin=n}async get(e){let n=await fetch(`${this.baseUrl}${e}`,{method:"GET"});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n.json()}async post(e,n){return await(await this.fetchWithErrorHandling(`${this.baseUrl}${e}`,{method:"POST",headers:{"Content-Type":"application/json",...this.headers},body:JSON.stringify(n)})).json()}async postStream(e,n,t){var g;let i=(g=(await this.fetchWithErrorHandling(`${this.baseUrl}${e}`,{method:"POST",headers:{"Content-Type":"application/json",...this.headers},body:JSON.stringify(n)})).body)==null?void 0:g.getReader(),o=new TextDecoder;if(i)try{let P="";for(;;){let{done:_,value:F}=await i.read();if(_)break;P+=o.decode(F,{stream:!0});let O;for(;(O=P.indexOf(`
`))!==-1;){let k=P.slice(0,O);if(P=P.slice(O+1),k.trim())try{let R=JSON.parse(k);t(R)}catch(R){d(this.plugin,`Error parsing JSON: ${R instanceof Error?R.message:String(R)}`)}}}}finally{i.releaseLock()}}};var Le=class{constructor(r,e){this.apiHelper=new _e(r,this.plugin),this.plugin=e}async getAvailableModels(){try{let r=await this.apiHelper.get("/api/tags");if(r.models&&Array.isArray(r.models))return r.models.map(e=>e.name);throw new Error("Unexpected response format from Ollama API")}catch(r){throw d(this.plugin,`Error fetching Ollama models: ${r}`),new Error("Failed to fetch Ollama models. Please ensure the Ollama server is running and the URL is correct.")}}async generateResponse(r,e){let n=this.plugin.settings.providerModels.ollama,t=n&&n.length>0?n[0]:"llama2";t||new ct.Notice('No Ollama model has been selected. Using default model "llama2".');let a="";try{return await this.apiHelper.postStream("/api/generate",{model:t,prompt:r,stream:!0},i=>{i.response&&(a+=i.response,e&&e(i.response))}),a}catch(i){throw d(this.plugin,`Error generating response with model ${t}: ${i}`),new Error(`Failed to generate response: ${i.message}`)}}};var qe=require("obsidian");var Ce=class{constructor(r){this.plugin=r,d(this.plugin,"Initializing YoutubeProvider")}async getTranscript(r){d(this.plugin,`[getTranscript] Attempting to fetch transcript for URL: ${r}`);try{let e=this.extractVideoId(r);if(!e)throw new Error("Invalid YouTube URL, cannot extract video ID");let n=await this.grabTranscriptBase(e);if(!n)throw new Error("No transcript found for this video");let i=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("text"),o="";for(let g=0;g<i.length;g++)o+=i[g].textContent+" ";return d(this.plugin,`[getTranscript] Transcript fetched successfully. Length: ${o.length}`),o.trim()}catch(e){throw d(this.plugin,`[getTranscript] Error fetching YouTube transcript: ${e}`),e}}async grabTranscriptBase(r){let e=`https://www.youtube.com/watch?v=${r}`,t=(await(0,qe.requestUrl)({url:e})).text,a=/"captionTracks":(\[.*?\])/,i=t.match(a);if(i&&i[1]){let o=JSON.parse(i[1]);if(o.length>0){let g=o[0].baseUrl;return(await(0,qe.requestUrl)({url:g})).text}}return null}extractVideoId(r){let e=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/,n=r.match(e);return n?n[1]:null}};var $e=class{constructor(r,e){this.apiHelper=new G("https://api.tavily.com",{"Content-Type":"application/json"},this.plugin),this.plugin=e,this.apiKey=r}async search(r){try{let e=await this.apiHelper.post("/search",{api_key:this.apiKey,query:r,search_depth:"advanced",include_answer:!0,include_images:!0,include_raw_content:!1,max_results:10});if(e)return JSON.stringify(e);throw new Error("No results found in Tavily response")}catch(e){throw d(this.plugin,`Error fetching results from Tavily: ${e}`),e.response&&(d(this.plugin,`Response status: ${e.response.status}`),d(this.plugin,`Response data: ${JSON.stringify(e.response.data)}`)),new Error(`Failed to fetch results from Tavily: ${e.message}`)}}};var Ne=class extends N.Plugin{async onload(){await this.loadSettings(),await this.loadParticlesJS(),this.youtubeProvider=new Ce(this),this.tavilyProvider=new $e(this.settings.tavilyApiKey,this),this.addSettingTab(new Ae(this.app,this)),this.registerView(oe,e=>new Ee(e,this)),this.addRibbonIcon("brain","Mesh AI Integration",()=>{this.activateView()})}async loadParticlesJS(){return new Promise(e=>{let n=document.createElement("script");n.src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js",n.onload=()=>e(),document.head.appendChild(n)})}async loadSettings(){this.settings=Object.assign({},st,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async activateView(){let{workspace:e}=this.app;e.detachLeavesOfType(oe);let n=e.getLeavesOfType(oe)[0];if(!n){let t=e.getRightLeaf(!1);if(t)await t.setViewState({type:oe,active:!0}),n=t;else{d(this,"Failed to create a new leaf for Mesh AI view");return}}e.revealLeaf(n)}async loadAllPatterns(){let e=await this.loadCustomPatterns(),n=await this.loadFabricPatterns();return[...new Set([...e,...n])].sort()}async loadCustomPatterns(){let e=this.app.vault.getAbstractFileByPath(this.settings.customPatternsFolder),n=[];if(e instanceof N.TFolder)for(let t of e.children)t instanceof N.TFile&&t.extension==="md"&&n.push(t.basename);return n.sort()}async loadFabricPatterns(){let e=this.app.vault.getAbstractFileByPath(this.settings.fabricPatternsFolder),n=[];if(e instanceof N.TFolder)for(let t of e.children)t instanceof N.TFile&&t.extension==="md"&&n.push(t.basename);return n.sort()}async downloadPatternsFromGitHub(){let e="https://api.github.com/repos/danielmiessler/fabric/contents/patterns",n="https://raw.githubusercontent.com/danielmiessler/fabric/main/patterns";try{this.app.vault.getAbstractFileByPath(this.settings.fabricPatternsFolder)instanceof N.TFolder||await this.app.vault.createFolder(this.settings.fabricPatternsFolder);let o=(await(0,N.requestUrl)({url:e})).json.filter(_=>_.type==="dir"),g=0,P=0;for(let _ of o)try{let F=`${_.name}.md`,O=`${n}/${_.name}/system.md`,k=`${this.settings.fabricPatternsFolder}/${F}`,R=await(0,N.requestUrl)({url:O}),D=this.app.vault.getAbstractFileByPath(k);D instanceof N.TFile?(await this.app.vault.modify(D,R.text),d(this,`Updated existing file: ${F}`)):(await this.app.vault.create(k,R.text),d(this,`Created new file: ${F}`)),g++}catch(F){d(this,`Error processing ${_.name}:`,F),F instanceof Error&&(d(this,`Error message: ${F.message}`),d(this,`Error stack: ${F.stack}`)),P++}new N.Notice(`Successfully downloaded/updated ${g} patterns. ${P} failed.`),await this.loadAllPatterns()}catch(t){d(this,"Error in downloadPatternsFromGitHub:",t),new N.Notice(`Failed to download patterns: ${t.message}`)}}async clearFabricPatternsFolder(){let e=this.app.vault.getAbstractFileByPath(this.settings.fabricPatternsFolder);if(e instanceof N.TFolder)for(let n of e.children)n instanceof N.TFile&&await this.app.fileManager.trashFile(n);else await this.app.vault.createFolder(this.settings.fabricPatternsFolder)}getProvider(e){switch(e){case"openai":return new Se(this.settings.openaiApiKey,this);case"google":return new xe(this.settings.googleApiKey,this);case"microsoft":return new Me(this.settings.microsoftApiKey,this);case"anthropic":return new Te(this.settings.anthropicApiKey,this);case"grocq":return new Ie(this.settings.grocqApiKey,this);case"ollama":return new Le(this.settings.ollamaServerUrl,this);default:throw new Error(`Unknown provider: ${e}`)}}};
